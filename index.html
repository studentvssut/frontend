<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Zenova Tech â€” Telegram Forwarder</title>

<link href="https://fonts.googleapis.com/css2?family=Syne:wght@700;800;900&family=DM+Mono:wght@400;500&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<!-- ğŸ”’ KEEP YOUR FULL CSS (UNCHANGED) -->
<style>
/* âš ï¸ YOUR CSS IS 100% CORRECT */
/* KEEP IT EXACTLY AS YOU POSTED */
/* NOT REPEATING HERE TO AVOID CONFUSION */
</style>
</head>

<body>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HEADER / UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<!-- âœ… KEEP ALL YOUR HTML MARKUP EXACTLY SAME -->
<!-- (Dashboard, Settings, Cards, Panels, etc.) -->
<!-- NOTHING REMOVED FROM YOUR UI -->

<!-- â›” IMPORTANT: UI ONLY â€“ NO LOGIC ABOVE THIS LINE -->


<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SUPABASE LOGIC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const SUPABASE_URL  = "https://aigfvgyoxaxbrwudjaza.supabase.co";
const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFpZ2Z2Z3lveGF4YnJ3dWRqYXphIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MTQyNjcsImV4cCI6MjA4NzA5MDI2N30.8rDD9AXPeIKj3n7NePqxMvzZGZ-BwMPviJbREzmvV5s";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let state = {
  settings: {},
  stats: { rounds: 0, success: 0, failed: 0 },
  logs: [],
  groups: []
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ LOAD DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadAll() {

  const { data: settings } = await sb.from("settings").select("*").eq("id", 1).single();
  const { data: stats }    = await sb.from("stats").select("*").eq("id", 1).single();
  const { data: logs }     = await sb.from("logs").select("*").order("created_at", { ascending: false }).limit(50);
  const { data: groups }   = await sb.from("groups").select("*").order("group_number");

  state.settings = settings || {};
  state.logs = logs || [];
  state.groups = groups || [];

  if (stats) {
    state.stats.rounds  = stats.total_rounds;
    state.stats.success = stats.total_success;
    state.stats.failed  = stats.total_failed;
  }

  renderUI();
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RENDER UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderUI() {

  document.getElementById("rounds").textContent  = state.stats.rounds;
  document.getElementById("success").textContent = state.stats.success;
  document.getElementById("failed").textContent  = state.stats.failed;
  document.getElementById("total").textContent   = state.stats.success + state.stats.failed;

  document.getElementById("sb-source").textContent   = state.settings.source_channel || "-";
  document.getElementById("sb-interval").textContent = (state.settings.interval_seconds || 0) + " sec";

  const running = state.settings.is_running;
  document.getElementById("statusState").textContent = running ? "ğŸŸ¢ RUNNING" : "â¸ PAUSED";
  document.getElementById("liveBadge").style.display   = running ? "inline-block" : "none";
  document.getElementById("pausedBadge").style.display = running ? "none" : "inline-block";

  document.getElementById("logPanel").innerHTML = state.logs.map(l => `
    <div class="log-entry">
      <span class="log-time">${new Date(l.created_at).toLocaleTimeString()}</span>
      <span class="${l.status === "success" ? "log-ok" : "log-fail"}">${l.message}</span>
    </div>
  `).join("");
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SAVE SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
window.saveSettings = async function () {

  const payload = {
    source_channel: document.getElementById("sourceInput").value,
    message_id: document.getElementById("msgIdInput").value,
    interval_seconds: parseInt(document.getElementById("intervalInput").value),
    updated_at: new Date().toISOString()
  };

  await sb.from("settings").update(payload).eq("id", 1);
  alert("âœ… Settings saved");
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PAUSE / RESUME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
window.togglePause = async function () {

  const newState = !state.settings.is_running;

  await sb.from("settings").update({
    is_running: newState,
    updated_at: new Date().toISOString()
  }).eq("id", 1);
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ REALTIME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
sb.channel("realtime-ui")

  .on("postgres_changes", { event: "UPDATE", table: "stats" }, payload => {
    state.stats.rounds  = payload.new.total_rounds;
    state.stats.success = payload.new.total_success;
    state.stats.failed  = payload.new.total_failed;
    renderUI();
  })

  .on("postgres_changes", { event: "INSERT", table: "logs" }, payload => {
    state.logs.unshift(payload.new);
    state.logs = state.logs.slice(0, 50);
    renderUI();
  })

  .on("postgres_changes", { event: "UPDATE", table: "settings" }, payload => {
    state.settings.is_running = payload.new.is_running;
    renderUI();
  })

  .subscribe();

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
loadAll();
</script>

</body>
</html>
